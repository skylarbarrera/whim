# Development overrides with hot-reload
# Usage: docker compose -f docker-compose.yml -f docker-compose.dev.yml watch

services:
  orchestrator:
    build:
      context: ..
      dockerfile: packages/orchestrator/Dockerfile
      target: builder
    command: bun --watch src/index.ts
    volumes:
      - ../packages/orchestrator/src:/app/src
      - ../packages/shared:/app/packages/shared
    develop:
      watch:
        - action: sync
          path: ../packages/orchestrator/src
          target: /app/src
        - action: rebuild
          path: ../packages/orchestrator/package.json

  intake:
    build:
      context: ..
      dockerfile: packages/intake/Dockerfile
      target: builder
    command: bun --watch src/index.ts
    volumes:
      - ../packages/intake/src:/app/src
    develop:
      watch:
        - action: sync
          path: ../packages/intake/src
          target: /app/src
        - action: rebuild
          path: ../packages/intake/package.json

  dashboard:
    profiles: []  # Enable in dev (removes profile restriction)
    build:
      context: ..
      dockerfile: packages/dashboard/Dockerfile
      target: builder
    command: npm run dev
    ports:
      - "3003:3000"
    environment:
      - ORCHESTRATOR_URL=http://whim-orchestrator:3000
    volumes:
      - ../packages/dashboard/app:/app/app
      - ../packages/dashboard/components:/app/components
    develop:
      watch:
        - action: sync
          path: ../packages/dashboard/app
          target: /app/app
        - action: sync
          path: ../packages/dashboard/components
          target: /app/components
        - action: rebuild
          path: ../packages/dashboard/package.json
